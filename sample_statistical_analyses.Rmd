---
title: "Preferring Politeness - Sample Statistical Analyses"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
library(rstanarm)
library(ggplot2)
library(dplyr)
library(remotes)
library(binom)
library(Bolstad)
library(pwr)
library(generics)
library(raster)
library(tibble)
library(LaplacesDemon)
library(scales)
library(BayesFactor)
library(BayesianFirstAid)
```

```{r load data}
raw_pp_data<-read.csv("sample_data.csv")
View(raw_pp_data)
```

```{r compile DV2}
#Create additional variable in which "reasoning" observations are coded as 1 = logical reasoning and 0 = other reasoning.
pp_data <- mutate(raw_pp_data, logical = ifelse(reasoning==4, 1, 0))
View(pp_data)
```

```{r count speaker preference}
#Create a frequency matrix to pull values from when running Bayesian binomial tests.
sp <- table(pp_data$age, pp_data$speaker_preference)
print(sp)
```

```{r verify data type}
#Verify that data is a matrix so values can be called in subsequent code.
is.matrix(sp)
```
```{r Bayesian binomial test 2s DV1}
#Run a Bayesian binomial test on the speaker preference of 2-year-olds, pulling values from frequency matrix.(Bayesian binomial tests determine whether the proportion of participants who prefer a polite speaker differs from chance.)
bbt2s <- bayes.binom.test(x=sp["2","1"], n=sp["2","0"]+sp["2","1"], comp.theta=0.5, cred.mass=0.95)
bbt2s
```



```{r Bayesian binomial test 3s DV1}
#Run a Bayesian binomial test on the speaker preference of 3-year-olds, pulling values from frequency matrix.
bbt3s <- bayes.binom.test(x=sp["3","1"], n=sp["3","0"]+sp["3","1"], comp.theta=0.5, cred.mass=0.95)
bbt3s
```

```{r Bayesian binomial test 4s DV1}
#Run a Bayesian binomial test on the speaker preference of 4-year-olds, pulling values from frequency matrix.
bbt4s <- bayes.binom.test(x=sp["4","1"], n=sp["4","0"]+sp["4","1"], comp.theta=0.5, cred.mass=0.95)
bbt4s
```

NOTE: It also seems important to determine whether the means of each age group differ significantly from each other. I am unsure if computing Bayes factors is the right approach here...I know that BF is supposed to compare the likelihood of two competing hypotheses/models, but it also seems like the Bayesian equivalent of a t test...

Alternatively, perhaps additional Bayesian binomial tests would do the trick (?).

Both option are coded below.

```{r Bayes factor 2vs3}
#Calculate a Bayes factor to compare the mean preference of 2- and 3-year olds.

BF2vs3 <- ttestBF(x=pp_data$speaker_preference[pp_data$age==2], y=pp_data$speaker_preference[pp_data$age==3], paired=FALSE)

BF2vs3
```

```{r Bayesian binomial test 2vs3}
#Run a Bayesian binomial test to compare the mean preferences of 2- and 3-year-olds. 

bbt2vs3 <- bayes.binom.test(x=sp["2","1"], n=sp["2","0"]+sp["2","1"], comp.theta=mean(pp_data$speaker_preference[pp_data$age==3]), cred.mass=0.95)

bbt2vs3
```

```{r Bayes factor 3vs4}
#Calculate a Bayes factor to compare the mean preference of 3- and 4-year olds.

BF3vs4 <- ttestBF(x=pp_data$speaker_preference[pp_data$age==3], y=pp_data$speaker_preference[pp_data$age==4], paired=FALSE)

BF3vs4
```

```{r Bayesian binomial test 3vs4}
#Run a Bayesian binomial test to compare the mean preferences of 3- and 4-year-olds. 

bbt3vs4 <- bayes.binom.test(x=sp["3","1"], n=sp["3","0"]+sp["3","1"], comp.theta=mean(pp_data$speaker_preference[pp_data$age==4]), cred.mass=0.95)

bbt3vs4
```

```{r Bayes factor 2vs4}
#Calculate a Bayes factor to compare the mean preference of 2- and 4-year olds.

BF2vs4 <- ttestBF(x=pp_data$speaker_preference[pp_data$age==2], y=pp_data$speaker_preference[pp_data$age==4], paired=FALSE)

BF2vs4
```

```{r Bayesian binomial test 2vs4}
#Run a Bayesian binomial test to compare the mean preferences of 2- and 4-year-olds. 

bbt2vs4 <- bayes.binom.test(x=sp["2","1"], n=sp["2","0"]+sp["2","1"], comp.theta=mean(pp_data$speaker_preference[pp_data$age==4]), cred.mass=0.95)

bbt2vs4
```

```{r count biases}
#Create frequency matrices to pull values from when running Bayesian binomial tests
sh <- table(pp_data$shape_preference)
print(sh)
co <- table(pp_data$color_preference)
print(co)
or <- table(pp_data$order_preference)
print(or)
si <- table(pp_data$side_preference)
print(si)
```

```{r binomial test shape bias}
#Run a Bayesian binomial test on overall shape preference, pulling values from frequency matrix.

bbt_sh <- bayes.binom.test(x=sh["1"], n=sh["1"]+sh["2"], comp.theta=0.5, cred.mass=0.95)
bbt_sh
```

```{r binomial test color bias}
#Run a Bayesian binomial test on overall color preference, pulling values from frequency matrix.

bbt_co <- bayes.binom.test(x=co["1"], n=co["1"]+co["2"], comp.theta=0.5, cred.mass=0.95)
bbt_co
```

```{r binomial test order bias}
#Run a Bayesian binomial test on overall order preference, pulling values from frequency matrix.

bbt_or <- bayes.binom.test(x=or["1"], n=or["1"]+or["2"], comp.theta=0.5, cred.mass=0.95)
bbt_or
```

```{r binomial test side bias}
#Run a Bayesian binomial test on overall side preference, pulling values from frequency matrix.

bbt_si <- bayes.binom.test(x=si["1"], n=si["1"]+si["2"], comp.theta=0.5, cred.mass=0.95)
bbt_si
```

```{r DV1 logistic model}
#Run a Bayesian logistic regression model: model speaker preference as a function of age.

DV1_model <- stan_glm(speaker_preference~age, family=binomial(), data=pp_data)

print(DV1_model)
```

```{r visualize DV1 logistic model}
#Visualize DV1 model.

DV1.y.fit <- fitted(DV1_model)
  
ggplot(pp_data, aes(x=age)) +
  geom_point(aes(y=speaker_preference), size=2, shape=1) +
  geom_jitter(aes(y=speaker_preference), width=0.03, height=0.03, alpha=0.3) +
  geom_smooth(aes(y=DV1.y.fit), size=1, alpha=0.5) +
  scale_y_continuous(breaks=c(0, 1)) +
  labs(title="Speaker preference as a funtion of age",x="age (years)", y="speaker preference") +
  theme_classic()
```
```{r DV2 primary logistic model}
#Run a Bayesian logistic regression model: model reasoning (with all reasoning levels) as a function of age.

DV2_pmodel <- stan_glm(reasoning~age, family=gaussian(), data=pp_data)

print(DV2_pmodel)
```

```{r visualize DV2 primary logistic model}
#Visualize DV2 primary model.

DV2_p.y.fit <- fitted(DV2_pmodel)
  
ggplot(pp_data, aes(x=age)) +
  geom_point(aes(y=reasoning), size=2, shape=1) +
  geom_jitter(aes(y=reasoning), width=0.03, height=0.03, alpha=0.3) +
  geom_smooth(aes(y=DV2_p.y.fit), size=1, alpha=0.5) +
  scale_y_continuous(breaks=c(0, 1)) +
  labs(title="Reasoning as a funtion of age",x="age (years)", y="reasoning") +
  theme_classic()
```

```{r DV2 secondary logistic model}
#Run a Bayesian logistic regression model: model logical reasoning as a function of age.

DV2_smodel <- stan_glm(logical~age, family=binomial(), data=pp_data)

print(DV2_smodel)
```

```{r visualize DV2 logistic model}
#Visualize DV2 model.

DV2_s.y.fit <- fitted(DV2_smodel)
  
ggplot(pp_data, aes(x=age)) +
  geom_point(aes(y=logical), size=2, shape=1) +
  geom_jitter(aes(y=logical), width=0.03, height=0.03, alpha=0.3) +
  geom_smooth(aes(y=DV2_s.y.fit), size=1, alpha=0.5) +
  scale_y_continuous(breaks=c(0, 1)) +
  labs(title="Logical reasoning as a funtion of age",x="age (years)", y="logical reasoning") +
  theme_classic()
```
